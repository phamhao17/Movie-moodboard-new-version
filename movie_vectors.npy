# prepare_vectors.py
import os
from PIL import Image
import numpy as np
import torch
from torchvision import transforms, models

resnet = models.resnet50(pretrained=True)
resnet.eval()

preprocess = transforms.Compose([
    transforms.Resize(224),
    transforms.CenterCrop(224),
    transforms.ToTensor(),
    transforms.Normalize(mean=[0.485,0.456,0.406], std=[0.229,0.224,0.225])
])

def get_vector(img_path):
    img = Image.open(img_path)
    img_t = preprocess(img).unsqueeze(0)
    with torch.no_grad():
        features = resnet(img_t)
    return features.squeeze().numpy()

folder = "movie_images"
files = [os.path.join(folder,f) for f in os.listdir(folder) if f.endswith((".jpg",".png"))]

vectors = np.array([get_vector(f) for f in files])
np.save("data/movie_vectors.npy", vectors)
np.save("data/movie_files.npy", np.array(files))
print("Vectors saved!")
